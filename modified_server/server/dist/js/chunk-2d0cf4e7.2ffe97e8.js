(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0cf4e7"],{"62c8":function(t,e,s){"use strict";s.r(e);var i=s("7a23"),n={class:"btn-container"},o=Object(i["h"])("button",{type:"button",class:"btn btn-primary","data-mdb-toggle":"modal","data-mdb-target":"#Modal"}," Start ",-1),r={class:"modal fade",id:"Modal",tabindex:"-1","aria-labelledby":"ModalLabel","aria-hidden":"true"},a={class:"modal-dialog"},c={class:"modal-content"},d=Object(i["h"])("div",{class:"modal-header"},[Object(i["h"])("h5",{class:"modal-title",id:"ModalLabel"},"Start")],-1),l={class:"modal-body"},h={class:"form-outline mb-4"},p=Object(i["h"])("label",{class:"form-label",for:"users-input"},"Users",-1),u={class:"form-outline mb-4"},f=Object(i["h"])("label",{class:"form-label",for:"spawn-rate-input"},"Spawn rate",-1),m={class:"form-outline mb-4"},b=Object(i["h"])("label",{class:"form-label",for:"workers-input"},"Workers",-1),_=Object(i["h"])("div",{class:"form-text",style:{"padding-bottom":"10px"}}," This will overwrite all hosts in your file ",-1),j={class:"form-outline mb-4"},O=Object(i["h"])("label",{class:"form-label",for:"host-input"},"Host",-1),v=Object(i["h"])("div",{class:"form-text",style:{"padding-bottom":"10px"}}," If time is not set, the test will not stop automatically ",-1),k={class:"form-outline mb-4"},w=Object(i["h"])("label",{class:"form-label",for:"time-input"},"Time in seconds",-1),g={type:"button",class:"btn btn-primary hidden","data-mdb-dismiss":"modal",id:"dismiss-btn",ref:"dismiss"};function y(t,e,s,y,U,S){var T=Object(i["A"])("Test");return Object(i["v"])(),Object(i["g"])("div",null,[Object(i["h"])("h3",null,Object(i["C"])(U.id),1),Object(i["h"])("div",n,[o,Object(i["h"])("button",{type:"button",class:"btn btn-danger",id:"stop-script-tests",onClick:e[0]||(e[0]=function(){return S.stopAll&&S.stopAll.apply(S,arguments)})}," Stop all "),Object(i["h"])("button",{type:"button",class:"btn btn-danger",id:"delete-script-tests",onClick:e[1]||(e[1]=function(){return S.deleteAll&&S.deleteAll.apply(S,arguments)})}," Delete all ")]),(Object(i["v"])(!0),Object(i["g"])(i["a"],null,Object(i["z"])(S.reversedTests,(function(t){return Object(i["v"])(),Object(i["e"])(T,{key:t[0],id:t[0],info:JSON.parse(t[1].info),data:JSON.parse(t[1].data),status:t[1].status,valid:t[1].valid,showPath:!1,url:s.url,openfaasUrl:s.openfaasUrl,pid:U.pid,sid:U.id,startMinimized:s.minimizeTests,onRestart:S.restart,onDelete:S.deleteTest,onStop:function(e){return S.stop(t[0])}},null,8,["id","info","data","status","valid","url","openfaasUrl","pid","sid","startMinimized","onRestart","onDelete","onStop"])})),128)),Object(i["h"])("div",r,[Object(i["h"])("div",a,[Object(i["h"])("div",c,[d,Object(i["h"])("div",l,[Object(i["h"])("form",null,[Object(i["h"])("div",h,[Object(i["I"])(Object(i["h"])("input",{type:"text",id:"users-input",class:"form-control","onUpdate:modelValue":e[2]||(e[2]=function(t){return U.users=t}),disabled:""},null,512),[[i["F"],U.users]]),p]),Object(i["h"])("div",u,[Object(i["I"])(Object(i["h"])("input",{type:"text",id:"spawn-rate-input",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=function(t){return U.spawnRate=t}),disabled:""},null,512),[[i["F"],U.spawnRate]]),f]),Object(i["h"])("div",m,[Object(i["I"])(Object(i["h"])("input",{type:"text",id:"workers-input",class:"form-control","onUpdate:modelValue":e[4]||(e[4]=function(t){return U.workers=t}),disabled:""},null,512),[[i["F"],U.workers]]),b]),_,Object(i["h"])("div",j,[Object(i["I"])(Object(i["h"])("input",{type:"text",id:"host-input",class:"form-control","onUpdate:modelValue":e[5]||(e[5]=function(t){return U.host=t}),disabled:""},null,512),[[i["F"],U.host]]),O]),v,Object(i["h"])("div",k,[Object(i["I"])(Object(i["h"])("input",{type:"text",id:"time-input",class:"form-control","onUpdate:modelValue":e[6]||(e[6]=function(t){return U.time=t}),disabled:""},null,512),[[i["F"],U.time]]),w]),Object(i["h"])("button",{type:"button",class:"btn btn-primary btn-block",id:"start-btn",onClick:e[7]||(e[7]=function(){return S.startFromModal&&S.startFromModal.apply(S,arguments)})}," Start ")]),Object(i["h"])("button",g,null,512)])])])])])}s("d3b7"),s("159b"),s("e9c4"),s("b64b"),s("ac1f"),s("5319"),s("4fad");var U=s("864c"),S={name:"Script",components:{Test:U["a"]},props:["url","openfaasUrl","socket","minimizeTests","update"],data:function(){return{id:this.$route.params.id,pid:this.$route.params.pid,tests:{},users:"1",spawnRate:"1",workers:"",host:"http://localhost:1337",time:""}},methods:{register:function(t){var e=this;this.socket.off(this.openfaasUrl+"_"+this.pid+"_"+this.id),this.socket.emit("register_script",{openfaasurl:this.openfaasUrl,project_name:this.pid,script_name:this.id,test_ids:t}),this.socket.on(this.openfaasUrl+"_"+this.pid+"_"+this.id,(function(t){if(IsJsonString(t)&&(t=JSON.parse(t),t.success))for(var s=0;s<t.tests.length;s++){var i=t.tests[s].id;if(i in e.tests){var n=t.tests[s].status;0===n?(e.disconnectTest(i),e.tests[i].status=0):1===n?e.tests[i].data=t.tests[s].data:3===n&&(e.tests[i].valid=!1,e.$emit("info",i+": There was an error running this test","red"),e.disconnectTest(i))}}}))},registerTest:function(t){this.socket.emit("register_test",{openfaasurl:this.openfaasUrl,project_name:this.pid,script_name:this.id,test_id:t})},disconnectTest:function(t){this.socket.emit("disconnect_test",{openfaasurl:this.openfaasUrl,project_name:this.pid,script_name:this.id,test_id:t})},init:function(){var t=this;document.querySelectorAll(".form-outline").forEach((function(t){new mdb.Input(t).init()})),fetch(this.url,{method:"POST",body:JSON.stringify({command:7,project_name:this.pid,script_name:this.id})}).then((function(t){return t.json()})).then((function(e){if(e.success){var s=[];for(var i in e.tests)1===e.tests[i].status&&s.push(e.tests[i].id);t.register(s),t.tests=e.tests}})).catch((function(e){t.$emit("info","Could not connect to server","red")})),this.socket.on(this.openfaasUrl+"_"+this.pid+"_"+this.id+"_test_start",(function(e){e.id in t.tests||(t.tests[e.id]=e,t.registerTest(e.id))})),this.socket.on(this.openfaasUrl+"_"+this.pid+"_"+this.id+"_test_delete",(function(e){for(var s=0;s<e.length;s++)e[s]in t.tests&&(delete t.tests[e[s]],t.disconnectTest(e[s]))})),this.socket.on(this.openfaasUrl+"_project_delete_"+this.pid,(function(e){t.$emit("info",t.pid+" is deleted","green"),t.$router.push({name:"Home"})}))},stopAll:function(){var t=this;this.$root.setUpConfirmation(this.id+": Are you sure you want to stop all tests?","Stop",(function(){fetch(t.url,{method:"POST",body:JSON.stringify({command:17,project_name:t.pid,script_name:t.id})}).then((function(t){return t.json()})).then((function(e){if(e.success)for(var s in t.$emit("info","Success","green"),t.socket.emit("disconnect_script",{project_name:t.pid,script_name:t.id}),t.tests)t.tests[s].status=0;else t.$emit("info","There was an error stopping tests","red")})).catch((function(){this.$emit("info","Could not connect to server","red")}))}))},deleteAll:function(){var t=this;this.$root.setUpConfirmation(this.id+": Are you sure you want to delete all tests?","Delete",(function(){fetch(t.url,{method:"POST",body:JSON.stringify({command:16,project_name:t.pid,script_name:t.id})}).then((function(t){return t.json()})).then((function(e){e.success?(t.$emit("info","Success","green"),t.socket.emit("disconnect_script",{project_name:t.pid,script_name:t.id}),t.socket.emit("test_delete",{openfaasurl:t.openfaasUrl,project_name:t.pid,script_name:t.id,ids:Object.keys(t.tests)}),t.tests={}):t.$emit("info","There was an error deleting tests","red")})).catch((function(){this.$emit("info","Could not connect to server","red")}))}))},start:function(t,e,s,i,n){var o=this;fetch(this.url,{method:"POST",body:JSON.stringify({command:5,project_name:this.pid,script_name:this.id,users:parseInt(t),spawn_rate:parseInt(e),workers:parseInt(s),host:i,time:parseInt(n)})}).then((function(t){return t.json()})).then((function(r){if(r.success){var a=r.id,c=r.started_at,d=JSON.stringify({users:t,spawn_rate:e,host:i,workers:s,time:n,started_at:c}),l=1,h=!0,p={id:a,info:d,status:l,valid:h,data:JSON.stringify([])};o.tests[a]=p,o.registerTest(a),o.socket.emit("test_start",{openfaasurl:o.openfaasUrl,project_name:o.pid,script_name:o.id,test:p})}else o.$emit("info",r.message,"red")})).catch((function(){o.$emit("info","Could not connect to server","red")}))},startFromModal:function(){return null!=this.host&&(this.host=this.host.replace("http://","").replace("https://",""),""!=this.host&&(this.host="http://"+this.host)),""===this.users?(this.$emit("info","Users cant be empty","red"),!1):isInteger(this.users)?""===this.spawnRate?(this.$emit("info","Spawn rate cant be empty","red"),!1):isInteger(this.spawnRate)?""===this.workers||isInteger(this.workers)?""==this.time||isInteger(this.time)?(this.$refs.dismiss.click(),void this.start(this.users,this.spawnRate,this.workers,this.host,this.time)):(this.$emit("info","Time must be an integer","red"),!1):(this.$emit("info","workers must be an integer","red"),!1):(this.$emit("info","Spawn rate must be an integer","red"),!1):(this.$emit("info","Users must be an integer","red"),!1)},restart:function(t){this.start(t.users,t.spawn_rate,t.workers,t.host,t.time)},deleteTest:function(t){delete this.tests[t],this.socket.emit("test_delete",{openfaasurl:this.openfaasUrl,project_name:this.pid,script_name:this.id,ids:[t]}),this.disconnectTest(t)},stop:function(t){this.socket.emit("test_stop",{openfaasurl:this.openfaasUrl,id:t})}},computed:{reversedTests:function(){return Object.entries(this.tests).reverse()}},beforeUnmount:function(){this.socket.emit("disconnect_script",{project_name:this.pid,script_name:this.id}),this.socket.off(this.openfaasUrl+"_"+this.pid+"_"+this.id),this.socket.off(this.openfaasUrl+"_"+this.pid+"_"+this.id+"_test_start"),this.socket.off(this.openfaasUrl+"_"+this.pid+"_"+this.id+"_test_delete"),this.socket.off(this.openfaasUrl+"_project_delete_"+this.pid)},mounted:function(){this.init()},updated:function(){this.update&&(this.init(),this.$root.updated())}},T=s("6b0d"),$=s.n(T);const I=$()(S,[["render",y]]);e["default"]=I}}]);
//# sourceMappingURL=chunk-2d0cf4e7.2ffe97e8.js.map